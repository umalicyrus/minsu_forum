generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

//
// â”€â”€â”€ ENUMS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//

enum Role {
  USER
  ADMIN
}

enum Visibility {
  PUBLIC
  GROUP
  FOLLOWERS
}

//
// â”€â”€â”€ USER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//

model User {
  id       Int     @id @default(autoincrement())
  name     String
  email    String  @unique
  password String
  bio      String?
  image    String?
  location String?
  role     Role    @default(USER)

  // Existing Q&A relations
  questions       Question[]
  answers         Answer[]
  comments        Comment[]
  qComments       QComment[]
  votes           Vote[]
  qVotes          QuestionVote[]
  bookmarks       Bookmark[]
  reports         Report[]
  hiddenQuestions NotInterested[]

  // ğŸ”¹ Social Features
  posts       Post[]
  memberships Membership[]

  // ğŸ‘‡ these two arrays are the â€œoppositeâ€ sides of Follow model
  followers Follow[] @relation("UserFollowers") // people who follow me
  following Follow[] @relation("UserFollowing") // people I follow

  // ğŸ”¹ Post-related actions
  postComments PostComment[]
  postVotes    PostVote[]
  hiddenPosts  PostNotInterested[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//
// â”€â”€â”€ Q&A MODELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//

model Question {
  id        Int     @id @default(autoincrement())
  title     String
  content   String?
  authorId  Int
  author    User    @relation(fields: [authorId], references: [id])
  anonymous Boolean @default(false)

  answers   Answer[]
  comments  QComment[]
  votes     QuestionVote[]
  bookmarks Bookmark[]
  topics    QuestionTopic[]
  reports   Report[]
  hiddenBy  NotInterested[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Answer {
  id         Int      @id @default(autoincrement())
  content    String
  questionId Int
  question   Question @relation(fields: [questionId], references: [id])
  authorId   Int
  author     User     @relation(fields: [authorId], references: [id])

  comments Comment[]
  votes    Vote[]
  reports  Report[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Comment {
  id       Int    @id @default(autoincrement())
  content  String
  authorId Int
  author   User   @relation(fields: [authorId], references: [id])
  answerId Int
  answer   Answer @relation(fields: [answerId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model QComment {
  id         Int      @id @default(autoincrement())
  content    String
  authorId   Int
  author     User     @relation(fields: [authorId], references: [id])
  questionId Int
  question   Question @relation(fields: [questionId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Vote {
  id       Int    @id @default(autoincrement())
  value    Int // 1 = upvote, -1 = downvote
  userId   Int
  user     User   @relation(fields: [userId], references: [id])
  answerId Int
  answer   Answer @relation(fields: [answerId], references: [id])

  createdAt DateTime @default(now())
}

model QuestionVote {
  id         Int      @id @default(autoincrement())
  value      Int // 1 = upvote, -1 = downvote
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  questionId Int
  question   Question @relation(fields: [questionId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, questionId])
}

model Bookmark {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  questionId Int
  question   Question @relation(fields: [questionId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, questionId]) // prevent duplicate bookmarks
}

model Topic {
  id        Int             @id @default(autoincrement())
  name      String          @unique
  questions QuestionTopic[]

  createdAt DateTime @default(now())
}

model QuestionTopic {
  questionId Int
  topicId    Int

  question Question @relation(fields: [questionId], references: [id])
  topic    Topic    @relation(fields: [topicId], references: [id])

  @@id([questionId, topicId])
}

model Report {
  id         Int       @id @default(autoincrement())
  reason     String
  userId     Int
  user       User      @relation(fields: [userId], references: [id])
  questionId Int?
  question   Question? @relation(fields: [questionId], references: [id])
  answerId   Int?
  answer     Answer?   @relation(fields: [answerId], references: [id])

  createdAt DateTime @default(now())
}

model NotInterested {
  id         Int      @id @default(autoincrement())
  userId     Int
  user       User     @relation(fields: [userId], references: [id])
  questionId Int
  question   Question @relation(fields: [questionId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, questionId]) // prevent duplicate "not interested"
}

//
// â”€â”€â”€ GROUPS AND MEMBERSHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//

model Group {
  id          Int          @id @default(autoincrement())
  name        String
  description String?
  memberships Membership[]
  posts       Post[]
}

model Membership {
  id      Int   @id @default(autoincrement())
  userId  Int
  groupId Int
  user    User  @relation(fields: [userId], references: [id])
  group   Group @relation(fields: [groupId], references: [id])

  @@unique([userId, groupId]) // prevent duplicate membership
}

//
// â”€â”€â”€ FOLLOWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//

model Follow {
  id          Int @id @default(autoincrement())
  followerId  Int
  followingId Int

  follower  User @relation("UserFollowing", fields: [followerId], references: [id])
  following User @relation("UserFollowers", fields: [followingId], references: [id])

  @@unique([followerId, followingId]) // prevent duplicate follows
}

//
// â”€â”€â”€ POSTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
//

model Post {
  id         Int         @id @default(autoincrement())
  title      String
  content    String?
  images     PostImage[]
  visibility Visibility  @default(PUBLIC)
  groupId    Int?
  group      Group?      @relation(fields: [groupId], references: [id])
  userId     Int
  user       User        @relation(fields: [userId], references: [id])

  // ğŸ”¹ Comments & Votes
  comments PostComment[]
  votes    PostVote[]

  // ğŸ”¹ Hidden
  hiddenBy PostNotInterested[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PostImage {
  id     Int    @id @default(autoincrement())
  url    String
  postId Int
  post   Post   @relation(fields: [postId], references: [id])
}

model PostComment {
  id       Int    @id @default(autoincrement())
  content  String
  postId   Int
  post     Post   @relation(fields: [postId], references: [id])
  authorId Int
  author   User   @relation(fields: [authorId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PostVote {
  id     Int  @id @default(autoincrement())
  value  Int // 1 = upvote, -1 = downvote
  postId Int
  post   Post @relation(fields: [postId], references: [id])
  userId Int
  user   User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, postId]) // prevent duplicate votes on the same post
}

model PostNotInterested {
  id     Int  @id @default(autoincrement())
  userId Int
  user   User @relation(fields: [userId], references: [id])
  postId Int
  post   Post @relation(fields: [postId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, postId]) // prevent duplicate "not interested"
}
